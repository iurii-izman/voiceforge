# Правило автопилота (копия для репо)

**Чтобы правило применялось в Cursor автоматически:** скопируйте этот файл в `.cursor/rules/agent-session-handoff.mdc` (каталог `.cursor/` в .gitignore, поэтому правило не коммитится).

Ниже — содержимое для `.cursor/rules/agent-session-handoff.mdc`:

```yaml
---
description: Автопилот конца сессии — коммит, пуш, следующий шаг, промпт для нового чата
alwaysApply: true
---

# Передача контекста между сессиями (автопилот)

Агент **в конце каждой сессии** (не только после «большой итерации») выполняет по возможности полный цикл и готовит следующий чат.

## Обязательно помнить

- **Ключи и доступы** — только в **keyring** (сервис `voiceforge`). Список имён: `docs/runbooks/keyring-keys-reference.md`. Не предлагать хардкод, не коммитить секреты. В облаке без keyring — Cursor My Secrets.
- **Коммит и пуш** — агент делает **сам** из **корня репозитория** (workspace path): `git add`, `git commit`, `git push`. Не предлагать команды «на потом» из домашней директории — иначе «not a git repository».

## Чеклист конца сессии

1. **Тесты:** `uv run pytest tests/ -q --tb=line` (или релевантный поднабор). При падении — починить или зафиксировать в next-iteration-focus.
2. **Коммит и пуш:** из корня репо (`cd <workspace path>`): `git add` затронутые файлы, осмысленный `git commit`, затем `git push`.
3. **Обновить фокус:** в `docs/runbooks/next-iteration-focus.md` записать:
   - **Следующий шаг** — один конкретный шаг или задача для следующего чата (блок «Следующий шаг» в начале файла);
   - дату обновления;
   - при необходимости — криты, совет.
4. **Выдать промпт для следующего чата** — один блок текста для копирования в начало нового чата (формат в `docs/runbooks/agent-context.md`). В промпте должны быть: VoiceForge, `@docs/runbooks/agent-context.md`, приоритеты (roadmap), напоминание про keyring/Fedora Atomic/toolbox/uv и **конкретная задача или «продолжить с …»** (из следующего шага).

## Подготовка к следующей сессии

- В `next-iteration-focus.md` блок **«Следующий шаг»** — это то, что следующий агент делает первым делом (или пользователь копирует в промпт). Агент при завершении сессии **всегда** обновляет этот блок, чтобы не было «неясного статуса» и наследованных незафиксированных задач.

## Ссылки

- Полный чеклист и формат промпта: `docs/runbooks/agent-context.md` (разделы «После каждой большой итерации», «Конец сессии», «Универсальный стартовый промпт»).
- Индекс документации (что актуально): `docs/DOCS-INDEX.md`.
```
