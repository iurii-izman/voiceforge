# Agent context (VoiceForge)

Единый контекст для Cursor-агента. Новый чат: приложи этот файл (@docs/runbooks/agent-context.md) — не ищи по проекту, работай по этому документу. Для продолжения плана развития можно дополнительно приложить @docs/runbooks/next-iteration-focus.md (обновляется агентом после каждой большой итерации).

---

## Проект

**VoiceForge** — локальный ассистент для аудио-встреч на Linux: PipeWire → STT → diarization → RAG → LLM. Alpha 0.1, 9 CLI-команд.

---

## Правила и окружение

- **Правила**: `.cursor/rules/cost-and-environment.mdc`
  Эффективность и стоимость: точечный поиск (grep/codebase_search), параллельные чтения, без лишних шагов. Ключи только в keyring; разработка в Fedora Atomic Cosmic (toolbox/uv).
- **Конфиг и ключи**: `docs/runbooks/config-env-contract.md`
  `VOICEFORGE_*`, keyring сервис `voiceforge`, ключи: `anthropic`, `openai`, `huggingface`. Полный список имён ключей (sonar_token, github_token, codecov, …) — `docs/runbooks/keyring-keys-reference.md`. Не коммитить ключи; в облаке/без keyring — Cursor My Secrets.
- **Cursor/агент**: `docs/runbooks/cursor-agent-setup.md`
  My Secrets только если нет keyring; локально — keyring, `./scripts/bootstrap.sh`, `uv sync --extra all`, `./scripts/doctor.sh`.

---

## Приоритет фич (roadmap)

Источник: `docs/roadmap-priority.md`. При предложении фич — по порядку 1→20.

| Приоритет | Направление |
|-----------|-------------|
| 1 | Шаблоны встреч в `analyze` |
| 2 | Обновление статусов action items по следующей встрече |
| 3 | Экспорт сессии (Markdown/PDF) |
| 4 | Выбор модели Ollama в конфиге |
| 5 | Документация «Первая встреча за 5 минут» |
| 6 | Отчёты по затратам (cost report) |
| 7 | Явный язык для STT |
| 8 | Расширенные e2e-тесты |
| 9 | Стриминговый STT в CLI (listen) |
| 10 | Live summary во время listen |
| 11 | Управление PII (вкл/выкл, только email) |
| 12 | Простой локальный Web UI |
| 13 | Десктопный UI (Tauri) |
| 14 | Офлайн-пакет (Flatpak/AppImage) |
| 15–20 | Smart trigger, бот, календарь, RAG-форматы, prompt caching, macOS/WSL2 |

Блоки: 1–4 быстрые победы; 5–7 доки/отчёты/STT; 8 e2e; 9–10 стриминг и live summary; 11–12 настройки и Web UI; 13–14 десктоп и упаковка; 15–20 опционально.

---

## После каждой большой итерации (обязательно)

Большая итерация = законченный блок фич (несколько пунктов плана или серия связанных правок). В конце такой итерации агент:

1. **Тесты** — запуск релевантных тестов (`uv run pytest tests/ …`), при необходимости правки до зелёного состояния.
2. **Коммит и пуш** — предложить пользователю выполнить `git add …`, осмысленный коммит и `git push` (или выполнить по запросу).
3. **Логи** — вести краткий лог сделанного в сессии (что реализовано, какие файлы затронуты); при подведении итога — включить в саммари.
4. **Итоговый блок для пользователя** — один раз в конце итерации выдать:
   - **Рекомендательные приоритетные задачи** по развитию проекта (до 5–7 пунктов из roadmap или плана развития, что логично делать дальше).
   - **Промпт для нового чата** — готовый блок для копирования в начало следующего чата (см. формат ниже).
   - **До 5 важных или критических проблем** — что можно пофиксить в следующей итерации (баги, долги, риски, слабые места из плана).
   - **1 общий совет** — на усмотрение агента (процесс, качество, архитектура, тесты, доки).
5. **Обновить фокус следующей итерации** — записать приоритетные задачи, криты и совет в `docs/runbooks/next-iteration-focus.md`, чтобы новый чат мог подтянуть контекст через `@docs/runbooks/next-iteration-focus.md`.

Формат промпта для нового чата: упоминание VoiceForge, контекст `@docs/runbooks/agent-context.md`, приоритеты (docs/roadmap-priority.md), напоминание про эффективность/keyring/Fedora Atomic/toolbox/uv, и конкретная задача или «продолжить с …».

---

## Конец сессии (обязательно)

Когда пользователь завершает чат или просит подвести итог:

1. **Саммари** (кратко): что сделано, что решено, что осталось в работе или отложено. По возможности — краткий лог ключевых изменений.
2. **Обновить** `docs/runbooks/next-iteration-focus.md` (приоритетные задачи, криты, дата), если была большая итерация.
3. **Промпт для следующего чата** — один блок текста, который можно скопировать и вставить в начало нового чата. В промпте должны быть:
   - упоминание проекта VoiceForge и что агент должен опираться на контекст из `@docs/runbooks/agent-context.md`;
   - приоритет фич из roadmap (или «по docs/roadmap-priority.md»);
   - краткое напоминание: эффективно и дёшево, keyring, Fedora Atomic/toolbox/uv.

Пример финального блока для копирования:

```
Проект VoiceForge. Контекст: @docs/runbooks/agent-context.md (правила, конфиг, приоритеты). Работай по нему без поиска по проекту. Приоритет фич — docs/roadmap-priority.md. Эффективно и дёшево; ключи в keyring; Fedora Atomic/toolbox/uv.
[Здесь задача или «продолжить с …».]
```

---

## Универсальный стартовый промпт (копируй в новый чат)

```
VoiceForge. Контекст: @docs/runbooks/agent-context.md. Работай по нему, не ищи по проекту. Приоритеты: docs/roadmap-priority.md. Эффективно и дёшево; keyring; Fedora Atomic/toolbox/uv.

[Твоя задача]
```
